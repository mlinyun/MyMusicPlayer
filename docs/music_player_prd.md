# 🎵 Android 音乐播放器产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品背景与目标

Android 音乐播放器是一款面向移动端用户的本地音乐播放应用，旨在提供流畅、功能完善的音乐播放体验。本产品专注于提供高质量的音频播放、直观的用户界面和丰富的歌词显示功能，满足用户日常音乐欣赏需求。

### 1.2 目标用户

- 喜欢本地存储音乐的安卓用户
- 注重音乐播放体验和歌词同步的用户
- 希望拥有简洁而功能完整的音乐播放器的用户

### 1.3 产品定位

一款轻量级但功能完整的本地音乐播放器，专注于提供高质量的播放体验和歌词同步功能，界面美观，操作简单直观。

### 1.4 产品价值

- 为用户提供流畅、稳定的本地音乐播放体验
- 通过同步歌词功能增强音乐欣赏体验
- 提供简洁直观的用户界面，降低使用门槛

## 2. 功能规格

### 2.1 播放控制模块

#### 2.1.1 基础播放控制

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| 播放/暂停 | P0 | 单一按钮控制，点击切换状态；播放状态下显示暂停图标，暂停状态下显示播放图标 |
| 停止 | P1 | 完全停止当前播放，资源释放，播放进度重置到起始位置 |
| 上一曲/下一曲 | P0 | 切换到播放列表中的前一首/后一首歌曲；到达列表边界时循环或停止（根据播放模式） |

#### 2.1.2 高级播放控制

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| 播放模式切换 | P1 | 支持单曲循环/列表循环/随机播放三种模式，点击图标循环切换 |
| 进度控制 | P0 | 通过 SeekBar 控制播放进度，拖动时实时预览时间，释放时跳转到对应位置 |
| 时间显示 | P0 | 显示当前播放时间/总时长，格式为 MM:SS |
| 音量控制 | P2 | 应用内音量调节，与系统音量同步 |

#### 2.1.3 交互规范

- 播放控制按钮采用通用图标设计，确保用户直观理解
- 大按钮间距确保不会误触
- 点击反馈：所有按钮操作有明确的视觉反馈（颜色变化或轻微形变）
- 播放状态切换时，按钮图标平滑过渡

### 2.2 播放列表管理模块

#### 2.2.1 列表显示与操作

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| 播放列表显示 | P0 | 使用 RecyclerView 展示歌曲列表，包含歌曲名、艺术家、时长信息 |
| 当前播放高亮 | P0 | 正在播放的歌曲在列表中高亮显示，并有图标标识 |
| 点击播放 | P0 | 点击列表中的歌曲直接播放该歌曲 |

#### 2.2.2 列表管理功能

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| 添加歌曲 | P0 | 支持从本地存储添加音频文件到播放列表 |
| 删除歌曲 | P0 | 从播放列表中删除指定歌曲，支持滑动删除或长按删除 |
| 列表排序 | P1 | 支持按名称、添加时间、艺术家等方式排序 |
| 清空列表 | P2 | 一键清空当前播放列表 |

#### 2.2.3 交互规范

- 列表项高度适中，方便点击操作
- 支持上拉显示完整列表，下拉收起返回主界面
- 列表滑动流畅，带有适当的物理滑动效果
- 当前播放项自动滚动到可见区域

### 2.3 歌词显示模块

#### 2.3.1 歌词加载与解析

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| LRC 格式支持 | P0 | 解析并显示标准 LRC 格式歌词文件 |
| 歌词自动匹配 | P1 | 根据歌曲信息自动匹配或下载对应歌词 |
| 无歌词处理 | P0 | 当无歌词时显示友好的提示界面或默认背景 |

#### 2.3.2 歌词显示与同步

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| 自动滚动 | P0 | 根据播放进度自动滚动歌词至当前播放句 |
| 当前句高亮 | P0 | 正在播放的歌词句子高亮显示 |
| 手动滚动 | P1 | 支持手动滑动查看其他部分的歌词，一段时间后自动恢复同步 |

#### 2.3.3 交互规范

- 歌词字体清晰易读，大小适中
- 当前播放行居中显示，高亮明显
- 滚动动画平滑，不突兀
- 垂直方向适当留白，提高可读性

### 2.4 封面与歌词视图切换

#### 2.4.1 视图模式

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| 封面视图 | P0 | 展示专辑封面、歌曲信息和基本控制元素 |
| 歌词视图 | P0 | 展示滚动歌词和基本控制元素 |
| 视图切换 | P0 | 点击封面区域或滑动屏幕切换不同视图模式 |

#### 2.4.2 封面显示

| 功能 | 优先级 | 详细说明 |
|------|-------|---------|
| 封面旋转 | P1 | 播放时专辑封面旋转动画，暂停时停止 |
| 封面获取 | P1 | 从歌曲元数据或专辑信息中提取封面图像 |
| 默认封面 | P0 | 无封面时显示默认图像 |

#### 2.4.3 交互规范

- 视图切换动画流畅，采用淡入淡出或滑动过渡效果
- 两种视图下控制元素位置保持一致，避免用户重新适应
- 封面旋转速度适中，不干扰用户视觉体验
- 记住用户最后使用的视图模式，下次打开应用时恢复

## 3. 用户界面设计规范

### 3.1 界面布局结构

应用采用垂直分区布局，从上到下依次为：

1. **顶部区域**：
   - 状态栏（应用名称/歌曲名称）
   - 返回/设置按钮

2. **内容显示区**：
   - 封面视图模式下显示专辑图片
   - 歌词视图模式下显示滚动歌词
   - 占据屏幕中央大部分空间

3. **信息区域**：
   - 歌曲标题（粗体）
   - 艺术家名称（常规字体）

4. **控制区域**：
   - 播放进度条
   - 播放时间显示（当前时间/总时长）
   - 播放控制按钮（上一曲、播放/暂停、下一曲、模式切换、列表）

5. **底部区域**（可选）：
   - 迷你播放列表或快速功能按钮

### 3.2 控件规范

#### 3.2.1 播放控制按钮

- 大小：主要按钮（播放/暂停）48dp，次要按钮 36dp
- 间距：按钮之间至少 16dp 间距，防止误触
- 触摸区域：实际图标大小 + 8dp 外边距
- 样式：圆形或胶囊形按钮，内含图标

#### 3.2.2 列表项

- 高度：单项高度 64-72dp
- 内容：左侧小型封面缩略图（可选），中间歌曲信息，右侧操作按钮或时长
- 分割线：1dp 浅色线条或 8dp 留白
- 选中状态：背景色变化 + 左侧标识图标

#### 3.2.3 进度控制

- SeekBar 高度：4-6dp
- 拖动按钮：12-16dp 圆形
- 已播放部分与未播放部分颜色区分明显
- 拖动时有放大效果增强可操作性

### 3.3 色彩规范

- **主色调**：#2196F3（蓝色系）
- **强调色**：#FF4081（粉色系）
- **背景色**：#FFFFFF（亮色主题）或 #121212（暗色主题）
- **文本色**：
  - 主要文本：#212121（亮色主题）或 #FFFFFF（暗色主题）
  - 次要文本：#757575（亮色主题）或 #BBBBBB（暗色主题）
- **控制元素**：主色调或强调色
- **高亮元素**：强调色

### 3.4 交互反馈规范

- **按钮点击**：轻微缩放（0.95-0.98）+ 颜色变暗/变亮效果
- **列表滑动**：标准 Android 惯性滚动效果，带边界回弹
- **长按操作**：触发振动反馈（40ms）
- **视图切换**：300ms 过渡动画
- **播放状态变化**：图标平滑过渡（150ms）

## 4. 音频播放架构

### 4.1 架构概述

音乐播放器采用前台服务（Service）+ 用户界面（UI）分离的架构模式，确保在应用切换到后台或屏幕关闭时仍能继续播放音乐。主要组件包括：

- **播放服务（MusicService）**：管理音频播放生命周期
- **播放控制器（PlaybackController）**：处理播放逻辑和状态管理
- **UI组件（Activity/Fragment）**：提供用户交互界面
- **通信机制（Broadcast/Binder）**：组件间的数据交互

### 4.2 模块协作关系

```
┌───────────────┐        ┌───────────────┐
│  用户界面层   │◄──────►│   数据管理层   │
│ (Activities)  │        │ (Repositories) │
└───────┬───────┘        └───────┬───────┘
        │                        │
        ▼                        ▼
┌───────────────┐        ┌───────────────┐
│  控制逻辑层   │◄──────►│   服务层      │
│(Controllers)  │        │ (Services)    │
└───────┬───────┘        └───────┬───────┘
        │                        │
        └────────────┬───────────┘
                     ▼
             ┌───────────────┐
             │  播放引擎层   │
             │(MediaPlayer)  │
             └───────────────┘
```

### 4.3 播放流程

1. **初始化流程**：
   - 应用启动 → 创建播放服务 → 绑定 UI → 加载上次播放状态
   - 服务启动 → 初始化播放引擎 → 注册音频焦点监听

2. **播放控制流程**：
   - 用户点击播放 → UI 发送指令 → 控制器处理 → 服务执行播放 → 状态回传 → UI 更新
   - 播放中 → 定时更新进度 → 同步歌词 → 刷新界面

3. **播放列表交互流程**：
   - 选择新歌曲 → 通知服务切换 → 加载新资源 → 开始播放 → 更新 UI

4. **后台播放流程**：
   - 应用进入后台 → 服务升级为前台服务 → 显示通知栏控制 → 保持播放状态
   - 用户通过通知栏控制 → 服务接收指令 → 执行对应操作 → 更新通知栏

### 4.4 状态管理

播放器实现状态机管理，主要状态包括：

- **空闲状态**（Idle）：初始化或停止后的状态
- **准备状态**（Prepared）：资源加载完成，可以开始播放
- **播放状态**（Playing）：正在播放音频
- **暂停状态**（Paused）：播放暂停，可以继续播放
- **停止状态**（Stopped）：播放停止，需要重新准备才能播放
- **错误状态**（Error）：播放出错，需要恢复

## 5. 用户交互流程图

### 5.1 基本播放控制流程

```
┌──────────┐     ┌──────────┐     ┌──────────┐
│  未播放  │─────► 播放音乐 ├─────►  播放中  │
└──────────┘     └──────────┘     └─────┬────┘
                                       │
                                       ▼
                                  ┌──────────┐
                        ┌────────►  暂停中  │
                        │         └─────┬────┘
                        │               │
                        └───────────────┘
```

### 5.2 歌曲切换流程

```
                  ┌──────────────────┐
                  │   当前歌曲播放   │
                  └────────┬─────────┘
                 ┌─────────┴─────────┐
                 ▼                   ▼
         ┌──────────────┐   ┌──────────────┐
         │ 点击上一曲   │   │  点击下一曲  │
         └───────┬──────┘   └───────┬──────┘
                 ▼                  ▼
         ┌──────────────┐   ┌──────────────┐
         │ 加载前一首   │   │  加载后一首  │
         └───────┬──────┘   └───────┬──────┘
                 └──────────┬───────┘
                            ▼
                  ┌──────────────────┐
                  │  开始播放新歌曲  │
                  └──────────────────┘
```

### 5.3 歌词/封面视图切换流程

```
       ┌──────────────┐   点击/滑动   ┌──────────────┐
       │  封面视图    │◄─────────────►│  歌词视图    │
       └──────┬───────┘               └──────┬───────┘
              │                             │
              ▼                             ▼
       ┌──────────────┐               ┌──────────────┐
       │显示专辑封面  │               │显示滚动歌词  │
       │旋转动画      │               │自动高亮当前句│
       └──────────────┘               └──────────────┘
```

### 5.4 播放列表交互流程

```
       ┌──────────────┐   
       │ 播放列表视图 │   
       └──────┬───────┘   
              │           
        ┌─────┴─────┐     
        ▼           ▼     
┌──────────────┐ ┌──────────────┐
│点击歌曲项    │ │长按歌曲项    │
└──────┬───────┘ └──────┬───────┘
       │                │
       ▼                ▼
┌──────────────┐ ┌──────────────┐
│切换并播放    │ │显示操作菜单  │
│所选歌曲      │ │(删除/详情等) │
└──────────────┘ └──────────────┘
```

## 6. 技术约束

### 6.1 开发技术约束

- **编程语言**：必须使用 Java 语言开发
- **最低支持 Android 版本**：Android 6.0 (API 级别 23)
- **目标 Android 版本**：Android 16 (API 级别 36)
- **音频播放引擎**：使用 MediaPlayer 或 ExoPlayer
- **UI 组件**：使用 RecyclerView 实现列表，使用 ConstraintLayout 布局

### 6.2 功能技术约束

- **歌词格式支持**：必须支持标准 .lrc 格式歌词文件
- **音频格式支持**：必须支持 MP3、WAV、FLAC、OGG 等常见音频格式
- **后台播放**：必须实现前台服务（Foreground Service）保证后台播放
- **存储访问**：遵循 Android 10+ 存储访问框架要求

### 6.3 性能约束

- **启动时间**：冷启动到可交互界面不超过 2 秒
- **播放响应**：点击播放到出声延迟不超过 300ms
- **内存占用**：正常使用内存占用不超过 150MB
- **CPU 使用率**：常规播放状态下 CPU 使用率不超过 5%
- **电池消耗**：1 小时播放电量消耗不超过 5%

### 6.4 质量约束

- **崩溃率**：DAU 崩溃率不超过 0.2%
- **ANR 率**：ANR 发生率不超过 0.1%
- **兼容性**：确保在主流 Android 设备上正常运行
- **异常处理**：所有可能的异常情况（无网络、文件损坏等）有合理处理策略

## 7. 附录

### 7.1 术语表

| 术语 | 解释 |
|------|------|
| LRC | 一种包含时间戳的歌词文本格式，用于歌词同步显示 |
| MediaPlayer | Android 平台原生的媒体播放器类 |
| ExoPlayer | Google 开源的第三方媒体播放器库 |
| 前台服务 | 在 Android 系统中具有较高优先级、提供用户可见通知的服务类型 |

### 7.2 参考文档

- Android 开发者文档：<https://developer.android.com/>
- ExoPlayer 官方文档：<https://exoplayer.dev/>
- Material Design 设计规范：<https://material.io/design>

### 7.3 修订历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|---------|------|
| v1.0 | 2024-05-16 | 初始版本 | GitHub Copilot |
